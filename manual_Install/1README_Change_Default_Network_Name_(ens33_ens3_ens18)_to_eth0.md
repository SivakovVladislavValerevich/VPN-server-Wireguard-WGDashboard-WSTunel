# Руководство по изменению названий сетевых интерфейсов с современного формата (ens33, ens3, ens18) на классический (eth0)

## Содержание

1. [Обзор](#обзор)
2. [Причины изменения имен интерфейсов](#причины-изменения-имен-интерфейсов)
3. [Проверка текущего названия интерфейса](#проверка-текущего-названия-интерфейса)
4. [Изменение имен интерфейсов](#изменение-имен-интерфейсов)
   - [Редактирование конфигурации GRUB](#редактирование-конфигурации-grub)
   - [Обновление загрузчика](#обновление-загрузчика)
   - [Обновление сетевых настроек](#обновление-сетевых-настроек)
5. [Перезагрузка и проверка](#перезагрузка-и-проверка)
6. [Устранение проблем](#устранение-проблем)
7. [Дополнительная информация](#дополнительная-информация)

## Обзор

Современные дистрибутивы Linux используют предсказуемое именование устройств для сетевых интерфейсов (например, ens33, enp0s3, ens18). Хотя это именование имеет свои преимущества, многие пользователи и системные администраторы привыкли к классическому формату имен eth0, eth1 и т.д.

Это руководство объясняет, как вернуть классическое именование сетевых интерфейсов в различных дистрибутивах Linux (Debian, Ubuntu, CentOS).

> **ВАЖНО:** Изменение имен сетевых интерфейсов рекомендуется выполнять сразу после установки системы. На рабочем сервере эти изменения могут привести к проблемам с сетью и потере доступа к серверу.

## Причины изменения имен интерфейсов

В современных дистрибутивах Linux используется прогнозируемое именование устройств, которое помогает:
- Определять физическое расположение устройства (встроенное или внешнее)
- Сохранять стабильные имена интерфейсов при добавлении/удалении оборудования
- Идентифицировать интерфейсы по их физическим характеристикам

Тем не менее, причины для возврата к классическому именованию могут включать:
- Совместимость со старым ПО и скриптами
- Привычный формат для системного администратора
- Более короткие и простые имена при настройке сети
- Упрощение настройки файрволов и сетевых сервисов

## Проверка текущего названия интерфейса

### Шаг 1: Определение текущего имени интерфейса

```bash
ip a
```

Вывод будет выглядеть примерно так:

```
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: ens33: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 00:0c:29:b0:dd:0d brd ff:ff:ff:ff:ff:ff
    inet 192.168.1.10/24 brd 192.168.1.255 scope global dynamic noprefixroute ens33
       valid_lft 86390sec preferred_lft 86390sec
    inet6 fe80::20c:29ff:feb0:dd0d/64 scope link 
       valid_lft forever preferred_lft forever
```

> В этом примере имя интерфейса - `ens33`. В вашем случае оно может отличаться (например, ens18, enp0s3 или другое).

### Шаг 2: Проверка переименования ядром

```bash
sudo dmesg | grep -i eth
```

Вы можете увидеть сообщение о переименовании интерфейса:

```
[    2.732567] e1000 0000:02:01.0 eth0: (PCI:33MHz:32-bit) 00:0c:29:b0:dd:0d
[    2.732572] e1000 0000:02:01.0 eth0: Intel(R) PRO/1000 Network Connection
[    3.345563] e1000 0000:02:01.0 ens33: renamed from eth0
```

## Изменение имен интерфейсов

### Редактирование конфигурации GRUB

#### Шаг 1: Открытие файла конфигурации GRUB

```bash
sudo nano /etc/default/grub
```

#### Шаг 2: Изменение параметров ядра

Найдите строку `GRUB_CMDLINE_LINUX` и добавьте параметры `net.ifnames=0 biosdevname=0`:

Было:
```
GRUB_CMDLINE_LINUX=""
```

или

```
GRUB_CMDLINE_LINUX="crashkernel=auto rhgb quiet"
```

Станет:
```
GRUB_CMDLINE_LINUX="net.ifnames=0 biosdevname=0"
```

или

```
GRUB_CMDLINE_LINUX="crashkernel=auto rhgb quiet net.ifnames=0 biosdevname=0"
```

> **Объяснение параметров:**
> - `net.ifnames=0` - отключает предсказуемое именование сетевых устройств
> - `biosdevname=0` - отключает использование имен устройств от BIOS

### Обновление загрузчика

После редактирования файла конфигурации необходимо обновить загрузчик GRUB.

#### В Debian/Ubuntu:

```bash
sudo update-grub
```

или

```bash
sudo grub-mkconfig -o /boot/grub/grub.cfg
```

или

```bash
sudo dpkg-reconfigure grub-pc
```

#### В CentOS/RHEL/Fedora:

```bash
sudo grub2-mkconfig -o /boot/grub2/grub.cfg
```

### Обновление сетевых настроек

После изменения имен интерфейсов необходимо обновить конфигурацию сети.

#### В системах с NetworkManager

Если ваша система использует NetworkManager, вам не требуется вносить дополнительные изменения в конфигурацию. NetworkManager автоматически обнаружит изменившееся имя интерфейса при следующей загрузке.

#### В системах с /etc/network/interfaces (Debian/Ubuntu)

Отредактируйте файл `/etc/network/interfaces`:

```bash
sudo nano /etc/network/interfaces
```

##### Для DHCP:

Было:
```
auto ens33
iface ens33 inet dhcp
```

Станет:
```
auto eth0
iface eth0 inet dhcp
```

##### Для статического IP:

Было:
```
auto ens33
iface ens33 inet static
        address 192.168.0.10
        netmask 255.255.255.0
        dns-nameservers 192.168.0.1
        gateway 192.168.0.1
```

Станет:
```
auto eth0
iface eth0 inet static
        address 192.168.0.10
        netmask 255.255.255.0
        dns-nameservers 192.168.0.1
        gateway 192.168.0.1
```

#### В системах с systemd-networkd

Если вы используете systemd-networkd, отредактируйте файлы конфигурации в директории `/etc/systemd/network/`:

```bash
sudo nano /etc/systemd/network/20-wired.network
```

Обновите имя интерфейса в секции `[Match]`:

Было:
```
[Match]
Name=ens33

[Network]
DHCP=yes
```

Станет:
```
[Match]
Name=eth0

[Network]
DHCP=yes
```

#### В системах с /etc/sysconfig/network-scripts/ (CentOS/RHEL)

Переименуйте файл конфигурации:

```bash
sudo mv /etc/sysconfig/network-scripts/ifcfg-ens33 /etc/sysconfig/network-scripts/ifcfg-eth0
```

И отредактируйте его:

```bash
sudo nano /etc/sysconfig/network-scripts/ifcfg-eth0
```

Измените параметр `DEVICE`:

Было:
```
DEVICE=ens33
```

Станет:
```
DEVICE=eth0
```

### Правила файрвола

После изменения имени сетевого интерфейса необходимо обновить правила файрвола. Соответствующие инструкции смотрите в [руководстве по настройке файрвола](2README_Configuring_the_firewall.md).

## Перезагрузка и проверка

### Шаг 1: Перезагрузите систему

```bash
sudo reboot
```

### Шаг 2: Проверьте новое имя интерфейса

После перезагрузки проверьте, что имя интерфейса изменилось:

```bash
ip a
```

Результат должен показать интерфейс с именем eth0:

```
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 00:0c:29:b0:dd:0d brd ff:ff:ff:ff:ff:ff
    inet 192.168.1.10/24 brd 192.168.1.255 scope global dynamic noprefixroute eth0
       valid_lft 86390sec preferred_lft 86390sec
    inet6 fe80::20c:29ff:feb0:dd0d/64 scope link 
       valid_lft forever preferred_lft forever
```

### Шаг 3: Проверьте доступность сети

```bash
ping -c 4 8.8.8.8
```

## Устранение проблем

### Проблема: Система не загружается или нет сетевого соединения

1. Загрузитесь в режиме восстановления (recovery mode) или с LiveCD
2. Проверьте конфигурацию GRUB и сетевых настроек
3. Исправьте ошибки в конфигурационных файлах
4. Перезапустите систему

### Проблема: Интерфейс не переименовался в eth0

Возможно, ваша система использует дополнительные правила переименования. Проверьте:

```bash
ls -la /etc/udev/rules.d/ | grep net
```

Если существуют файлы типа `70-persistent-net.rules`, изучите их содержимое и при необходимости отредактируйте или удалите:

```bash
sudo rm /etc/udev/rules.d/70-persistent-net.rules
```

## Дополнительная информация

### Как работает предсказуемое именование интерфейсов

Современное именование сетевых интерфейсов следует определенным схемам:

1. `en` - Ethernet
2. `wl` - WLAN (беспроводные сети)
3. `ww` - WWAN (мобильные сети)

За префиксом следуют дополнительные идентификаторы:
- `p<шина><слот>` - номер PCI-шины и слота (например, enp2s0)
- `s<слот>[f<функция>]` - слот устройства (например, ens33)
- `o<индекс>` - порядковый номер устройства (например, eno1)

### Причины разных имен в виртуальных машинах

В виртуальных средах имена могут различаться в зависимости от используемого гипервизора и типа эмулируемого сетевого оборудования:

- VMware обычно использует `ens33` или `ens192`