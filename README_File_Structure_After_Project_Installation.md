# Структура файлов после установки VPN-инфраструктуры WireGuard

## Содержание

1. [Обзор](#обзор)
2. [Структура файлов после установки проекта](#структура-файлов-после-установки-проекта)
3. [Основной скрипт установки (`install.sh`)](#основной-скрипт-установки-installsh)
4. [Скрипт удаления (`uninstall.sh`)](#скрипт-удаления-uninstallsh)
5. [Скрипт переустановки (`reinstall.sh`)](#скрипт-переустановки-reinstallsh)
6. [Файл конфигурации (`config.conf`)](#файл-конфигурации-configconf)
7. [Модульные скрипты (`scripts/`)](#модульные-скрипты-scripts)
    - [`00_check_prerequisites.sh`](#00_check_prerequisitessh)
    - [`01_prepare_server.sh`](#01_prepare_serversh)
    - [`02_change_network_names.sh`](#02_change_network_namessh)
    - [`03_configure_firewall.sh`](#03_configure_firewallsh)
    - [`04_install_wireguard.sh`](#04_install_wireguardsh)
    - [`05_install_wgdashboard.sh`](#05_install_wgdashboardsh)
    - [`06_install_wstunnel.sh`](#06_install_wstunnelsh)
    - [`07_backup_management.sh`](#07_backup_managementsh)
    - [`08_log_management.sh`](#08_log_managementsh)
8. [Вспомогательные утилиты (`scripts/utils/`)](#вспомогательные-утилиты-scriptsutils)
    - [`detect_network.sh`](#detect_networksh)
    - [`log_utils.sh`](#log_utilssh)
    - [`backup_utils.sh`](#backup_utilssh)
    - [`system_utils.sh`](#system_utilssh)
9. [Директория логов (`logs/`)](#директория-логов-logs)
10. [Директория бэкапов (`backups/`)](#директория-бэкапов-backups)
11. [Руководства](#руководства)

## Обзор

Данная структура скриптов предназначена для автоматизированного развертывания безопасной VPN-инфраструктуры на базе WireGuard с веб-интерфейсом WGDashboard и опциональной обфускацией трафика через Wstunnel. Подход основан на модульности, что обеспечивает гибкость установки и обслуживания. Все шаги установки и настройки соответствуют предоставленным руководствам.

## Структура файлов после установки проекта

```
.
├── config.conf                    # Файл конфигурации с настройками по умолчанию
├── manual/                        # Директория с руководствами пользователя
│   └── wstunnel_user_guide.md    # Руководство по использованию WSTunnel
├── manual_Install/                # Директория с руководствами по ручной установке
│   ├── 0README_Preparing_the_server_for_installation_and_configuration.md
│   ├── 1README_Change_Default_Network_Name_(ens33_ens3_ens18)_to_eth0.md
│   ├── 2README_Configuring_The_Firewall.md
│   ├── 3README_WireGuard_install.md
│   ├── 4README_WGDashboard_Install.md
│   └── 5README_WSTunel_Obfuscation.md
├── logs/                         # Директория для логов
│   ├── install_log.txt          # Детальный лог процесса установки
│   ├── uninstall_log.txt        # Детальный лог процесса удаления
│   ├── operations_log.txt       # Лог общих операций и текущей работы скриптов
│   └── reinstall_log.txt        # Детальный лог процесса переустановки
├── backups/                      # Директория для бэкапов
│   ├── logs/                    # Архивы логов (после ротации)
│   ├── configs/                 # Бэкапы конфигурационных файлов
│   └── templates/               # Шаблоны оригинальных конфигурационных файлов
├── scripts/                      # Директория с основными скриптами
│   ├── install.sh              # Основной скрипт установки
│   ├── uninstall.sh           # Скрипт удаления инфраструктуры
│   ├── backup.sh              # Управление резервными копиями
│   ├── logs.sh               # Управление логами
│   ├── reinstall.sh          # Скрипт переустановки инфраструктуры
│   ├── 00_check_prerequisites.sh    # Проверка предварительных требований
│   ├── 01_prepare_server.sh         # Подготовка сервера (обновление, пакеты)
│   ├── 02_change_network_names.sh   # Изменение имен сетевых интерфейсов (опционально)
│   ├── 03_configure_firewall.sh     # Настройка файрвола iptables
│   ├── 04_install_wireguard.sh      # Установка и настройка WireGuard
│   ├── 05_install_wgdashboard.sh    # Установка и настройка WGDashboard
│   ├── 06_install_wstunnel.sh       # Установка и настройка Wstunnel (опционально)
│   ├── 07_backup_management.sh      # Настройка системы бэкапов
│   ├── 08_log_management.sh         # Настройка системы управления логами
│   └── utils/                       # Вспомогательные утилиты
│       ├── backup_utils.sh         # Функции для создания и управления бэкапами
│       ├── detect_network.sh       # Определение сетевых параметров (IP сервера, шлюз)
│       ├── log_utils.sh           # Функции для стандартизированного логирования
│       └── system_utils.sh        # Общие системные утилиты
├── README.md                      # Основная документация проекта
├── README_Manual_Install.md       # Руководство по ручной установке
└── README_File_Structure_After_Project_Installation.md     # Документация по структуре файлов и директорий после установки проекта
```

## Файлы и директории после установки
```
.
/etc/
├── wireguard/                    # Основная директория WireGuard
│   ├── wg0.conf                 # Основной конфиг WireGuard
│   ├── privatekey              # Приватный ключ сервера
│   ├── publickey               # Публичный ключ сервера
│   └── wstunnel_secret        # Секретный ключ WSTunnel (если установлен)
├── systemd/system/              # Файлы служб systemd
│   ├── wg-quick@wg0.service    # Служба WireGuard
│   ├── wg-dashboard.service    # Служба WGDashboard (если установлен)
│   └── wstunnel.service        # Служба WSTunnel (если установлен)
├── iptables/                    # Конфигурация файрвола
│   └── rules.v4                # Правила iptables
└── cron.d/                      # Задания cron
    ├── vpn-backup              # Задание для резервного копирования
    └── vpn-logs                # Задание для ротации логов

/root/
├── WGDashboard/                 # Директория WGDashboard (если установлен)
│   └── src/                    # Исходный код и конфигурация WGDashboard
├── wstunnel_client_info.txt    # Информация для подключения WSTunnel
└── .wg-dashboard/              # Конфигурация WGDashboard
    └── db/                     # База данных WGDashboard

/usr/local/
├── bin/
│   └── wstunnel                # Исполняемый файл WSTunnel (если установлен)
└── lib/
    └── systemd/system/         # Дополнительные службы systemd

/var/log/
└── vpn/                        # Системные логи VPN-сервера
    ├── wireguard.log          # Логи WireGuard
    ├── wgdashboard.log        # Логи WGDashboard
    └── wstunnel.log           # Логи WSTunnel
```

## Основной скрипт установки (`install.sh`)

**Назначение:** Главный скрипт, оркеструющий весь процесс установки.
**Функции:**
1.  Загружает настройки из `config.conf`. Если файл отсутствует, копирует `config.example.conf` (если есть) или создает `config.conf` с значениями по умолчанию и предлагает пользователю отредактировать его перед продолжением.
2.  Инициализирует систему логирования с помощью `scripts/utils/log_utils.sh`. Логи `install.sh` пишутся в `logs/install_log.txt` и дублируются в `logs/operations_log.txt`.
3.  Проверяет наличие прав суперпользователя.
4.  Автоматически определяет IP-адрес сервера и IP-адрес шлюза (маршрутизатора) с помощью `scripts/utils/detect_network.sh`.
5.  Запрашивает у пользователя подтверждение корректности определенных IP-адресов. Если пользователь не согласен, предоставляет возможность ввести IP-адреса вручную. Каждый IP-адрес уточняется отдельно. Предлагает сохранить введенные пользователем IP в `config.conf` для будущих запусков.
6.  Информирует пользователя о шагах, которые будут выполнены.
7.  Предлагает пользователю выбор компонентов для установки:
    *   **Обязательные компоненты** (устанавливаются всегда, пользователь информируется): `00_check_prerequisites.sh`, `01_prepare_server.sh`, `03_configure_firewall.sh`, `04_install_wireguard.sh`.
    *   **Рекомендуемые/Опциональные компоненты** (пользователь может выбрать, устанавливать ли): `02_change_network_names.sh` (изменение имени сетевого интерфейса), `05_install_wgdashboard.sh` (веб-интерфейс для WireGuard), `06_install_wstunnel.sh` (обфускация трафика). Выбор пользователя сохраняется в `config.conf` для последующих запусков (`CHANGE_NETWORK_NAMES_ENABLED`, `INSTALL_WGDASHBOARD_ENABLED`, `INSTALL_WSTUNNEL_ENABLED`).
8.  Последовательно вызывает выбранные модульные скрипты из директории `scripts/`.
9.  Запускает скрипты `07_backup_management.sh` и `08_log_management.sh` для настройки автоматического резервного копирования и ротации логов, если это включено в `config.conf`. Предлагает пользователю включить эти функции, если они выключены.
10. Логирует все основные этапы и результаты выполнения в `logs/install_log.txt` и `logs/operations_log.txt`.
11. В конце установки выводит информацию о доступах (порты, URL WGDashboard, данные для WSTunnel клиента).

## Скрипт удаления (`uninstall.sh`)

**Назначение:** Полное удаление всех установленных компонентов VPN-инфраструктуры.
**Функции:**
1.  Загружает настройки из `config.conf`.
2.  Инициализирует систему логирования. Логи `uninstall.sh` пишутся в `logs/uninstall_log.txt` и дублируются в `logs/operations_log.txt`.
3.  Запрашивает подтверждение у пользователя перед началом удаления.
4.  Останавливает и удаляет все связанные службы (WireGuard, WGDashboard, Wstunnel, cron задачи для логов и бэкапов).
5.  Удаляет установленные пакеты (опционально, с подтверждением пользователя, чтобы не удалить нужные для других целей пакеты).
6.  Удаляет конфигурационные файлы, директории `WGDashboard`, ключи WireGuard, секрет Wstunnel.
7.  Восстанавливает оригинальные конфигурационные файлы из бэкапов, если это возможно и выбрано пользователем (например, `/etc/default/grub`, сетевые настройки).
8.  Удаляет правила файрвола, относящиеся к VPN.
9.  Логирует все действия в `logs/uninstall_log.txt` и `logs/operations_log.txt`.

## Скрипт переустановки (`reinstall.sh`)

**Назначение:** Удобный способ полностью переустановить VPN-инфраструктуру.
**Функции:**
1.  Загружает настройки из `config.conf`.
2.  Инициализирует систему логирования. Логи `reinstall.sh` пишутся в `logs/reinstall_log.txt` и дублируются в `logs/operations_log.txt`.
3.  Запрашивает у пользователя подтверждение, так как это деструктивная операция.
4.  Предлагает сохранить (сделать бэкап) текущие конфигурации пользователей WireGuard (из WGDashboard или `wg0.conf`) и другие важные данные (например, секрет WSTunnel), если `CONFIG_BACKUP_ENABLED` в `config.conf` установлен в `true`.
5.  Вызывает `uninstall.sh` для полного удаления текущей установки.
6.  Вызывает `install.sh` для выполнения чистой установки.
7.  Логирует свои действия.

## Файл конфигурации (`config.conf`)

**Назначение:** Централизованное хранение всех настраиваемых параметров установки.
**Содержимое (переменные Bash):**
*   `WG_PORT`: Порт WireGuard (по умолчанию `20820`).
*   `WGDASHBOARD_PORT`: Порт WGDashboard (по умолчанию `10086`).
*   `WSTUNNEL_PORT`: Порт Wstunnel (по умолчанию `443`).
*   `WG_SERVER_IP_PRIVATE`: IP-адрес сервера WireGuard во внутренней VPN-сети (например, `10.0.0.1`). Это IP-адрес, который будет у сервера в `wg0` интерфейсе.
*   `WG_NETWORK_PRIVATE`: Диапазон IP-адресов для VPN-клиентов (например, `10.0.0.0/24`). Из этого диапазона WGDashboard будет назначать адреса клиентам.
*   `SERVER_PUBLIC_IP`: Публичный IP-адрес сервера (может определяться автоматически). Этот IP используется клиентами для подключения.
*   `SERVER_DEFAULT_GATEWAY_IP`: IP-адрес шлюза (маршрутизатора) для сервера (может определяться автоматически). Используется для настройки маршрутизации.
*   `SERVER_NETWORK_INTERFACE`: Имя основного сетевого интерфейса сервера (например, `eth0`, определяется автоматически).
*   `LOG_OPERATIONS_ROTATION_DAYS`: Периодичность ротации `operations_log.txt` (по умолчанию `7` дней).
*   `LOG_OPERATIONS_BACKUP_ENABLED`: Включить автоматическое резервное копирование (архивацию) `operations_log.txt` (`true`/`false`, по умолчанию `true`).
*   `LOG_OPERATIONS_BACKUP_RETENTION_DAYS`: Срок хранения архивных копий `operations_log.txt` (по умолчанию `30` дней). `install_log.txt` и `uninstall_log.txt` не ротируются, а перезаписываются/дополняются.
*   `CONFIG_BACKUP_ENABLED`: Включить автоматическое резервное копирование конфигураций (`true`/`false`, по умолчанию `true`).
*   `CONFIG_BACKUP_RETENTION_DAYS`: Срок хранения бэкапов конфигураций (по умолчанию `30` дней).
*   `INSTALL_TYPE`: Тип установки (`FULL` или `CUSTOM`). При `CUSTOM` запрашиваются опциональные компоненты. По умолчанию `CUSTOM`.
*   `PROMPT_USER_FOR_SETTINGS`: Запрашивать ли у пользователя подтверждение/изменение настроек при запуске скриптов, даже если они определены в `config.conf` (`true`/`false`, по умолчанию `true`).
*   `CHANGE_NETWORK_NAMES_ENABLED`: Изменять ли имена сетевых интерфейсов на `eth0` (`true`/`false`, по умолчанию `false`). Управляется выбором пользователя в `install.sh`.
*   `INSTALL_WGDASHBOARD_ENABLED`: Устанавливать ли WGDashboard (`true`/`false`, по умолчанию `true`). Управляется выбором пользователя в `install.sh`.
*   `INSTALL_WSTUNNEL_ENABLED`: Устанавливать ли Wstunnel (`true`/`false`, по умолчанию `false`). Управляется выбором пользователя в `install.sh`.
*   `FIREWALL_ALLOW_PING`: Разрешать ли ICMP (пинги) на сервер (`true`/`false`, по умолчанию `true`).
*   `FIREWALL_ENABLE_DOS_PROTECTION`: Включать ли базовую защиту от DDoS для файрвола (`true`/`false`, по умолчанию `true`).
*   `WGDASHBOARD_PASSWORD`: Пароль для доступа к WGDashboard. Если оставить пустым, будет сгенерирован случайный пароль при установке, который будет показан пользователю.
*   `WSTUNNEL_SECRET`: Секретный ключ для Wstunnel. Если оставить пустым, будет сгенерирован случайный при установке и показан пользователю.
*   Другие специфичные настройки (например, параметры для `wg-quick` или `WGDashboard`, DNS серверы для клиентов).

## Модульные скрипты (`scripts/`)

Каждый скрипт в этой директории отвечает за конкретный этап установки или настройки. Они вызываются основным скриптом `install.sh`.

### `00_check_prerequisites.sh`
*   Проверяет наличие прав суперпользователя.
*   Определяет и проверяет совместимость дистрибутива и версии ОС (Debian/Ubuntu).
*   Проверяет наличие активного интернет-соединения.
*   Проверяет, свободны ли порты, указанные в `config.conf`.
*   Проверяет наличие базовых утилит (curl, wget, git и т.д.).

### `01_prepare_server.sh`
*   Обновляет списки пакетов и саму систему (`apt-get update -y && apt-get full-upgrade -y`).
*   Устанавливает общие необходимые пакеты, которые могут потребоваться для различных компонентов (например, `sudo`, `curl`, `wget`, `git`, `python3`, `python3-pip`, `python3-venv`, `net-tools`, `openssl`, `iptables-persistent`).
*   Создает директории `logs/` и `backups/`, если они не существуют.
*   Применяет базовые настройки безопасности, если это необходимо (например, настройка `sudo`).

### `02_change_network_names.sh`
*   **Опциональный скрипт.**
*   Определяет текущее имя основного сетевого интерфейса.
*   Если имя отличается от `eth0` (например, `ens33`, `enp0s3`), предлагает пользователю изменить его на `eth0`.
*   Редактирует конфигурацию GRUB (`/etc/default/grub`), добавляя `net.ifnames=0 biosdevname=0`.
*   Обновляет GRUB (`update-grub`).
*   Обновляет конфигурационные файлы сети (например, в `/etc/network/interfaces` или Netplan YAML файлах), заменяя старое имя интерфейса на `eth0`.
*   Сохраняет резервные копии изменяемых файлов в `backups/configs/`.
*   Предупреждает о необходимости перезагрузки для применения изменений.

### `03_configure_firewall.sh`
*   Устанавливает `iptables-persistent` для сохранения правил файрвола между перезагрузками.
*   Включает IP-форвардинг (`net.ipv4.ip_forward=1` в `/etc/sysctl.conf` и применяет через `sysctl -p`).
*   Очищает существующие правила `iptables`.
*   Устанавливает политики по умолчанию (например, `INPUT DROP`, `FORWARD DROP`, `OUTPUT ACCEPT`).
*   Добавляет разрешающие правила для:
    *   Loopback интерфейса.
    *   Установленных и связанных соединений.
    *   SSH (порт 22).
    *   ICMP (пинги), если включено в `config.conf`.
    *   Порта WireGuard (`$WG_PORT` UDP).
    *   NAT для трафика WireGuard (`-t nat -A POSTROUTING -o $INTERFACE -j MASQUERADE`).
    *   Перенаправления трафика с интерфейса `wg0`.
    *   Порта WGDashboard (`$WGDASHBOARD_PORT` TCP).
    *   Порта Wstunnel (`$WSTUNNEL_PORT` TCP/UDP), если установка Wstunnel выбрана.
    *   Базовой защиты от DDoS-атак (ограничение новых соединений, блокировка подозрительных TCP флагов), если включено в `config.conf`.
*   Сохраняет правила с помощью `netfilter-persistent save`.

### `04_install_wireguard.sh`
*   Устанавливает пакеты `wireguard` и `wireguard-tools`.
*   Создает директорию `/etc/wireguard/`, если она не существует.
*   Генерирует пару ключей (приватный и публичный) для сервера WireGuard (`wg genkey`, `wg pubkey`) и сохраняет их в `/etc/wireguard/privatekey` и `/etc/wireguard/publickey`. Устанавливает права `600` на приватный ключ.
*   Изменяет порт по умолчанию в скрипте `/usr/bin/wg-quick` на указанный в `$WG_PORT` (согласно руководству, если это необходимо для обхода блокировок). Создает бэкап оригинального `wg-quick`.
*   Создает конфигурационный файл `/etc/wireguard/wg0.conf`, используя сгенерированный приватный ключ, IP-адрес сервера из `$WG_SERVER_IP_PRIVATE`, порт `$WG_PORT` и команды `PostUp`/`PostDown` для `iptables`.
*   Включает и запускает службу `wg-quick@wg0.service`.
*   Проверяет статус службы.

### `05_install_wgdashboard.sh`
*   **Опциональный скрипт.** Выполняется, если `INSTALL_WGDASHBOARD_ENABLED` в `config.conf` установлен в `true`.
*   Устанавливает зависимости: `python3`, `python3-pip`, `python3-venv`, `git`, `net-tools`. Пакет `pip` должен быть установлен для `python3`.
*   Клонирует репозиторий WGDashboard с GitHub в домашнюю директорию пользователя, от имени которого запускается скрипт (обычно root).
*   Переходит в директорию `WGDashboard/src` и делает скрипт `wgd.sh` исполняемым.
*   Устанавливает права `755` на `/etc/wireguard` рекурсивно.
*   Запускает `./wgd.sh install` для установки WGDashboard.
*   Создает файл службы systemd (`/etc/systemd/system/wg-dashboard.service`) для управления WGDashboard, указывая правильные пути к `wgd.sh` и рабочей директории.
*   Устанавливает права на файл службы, перезагружает демона systemd, включает и запускает службу `wg-dashboard.service`.
*   Проверяет статус службы.
*   Запись производится в соответствующие файлы в директории `logs/`:
    *   `log_info`, `log_warning`, `log_error`, `log_debug` пишут в `operations_log.txt`.
    *   `log_install` пишет в `install_log.txt` И в `operations_log.txt`.
    *   `log_uninstall` пишет в `uninstall_log.txt` И в `operations_log.txt`.
    *   `log_reinstall` пишет в `reinstall_log.txt` И в `operations_log.txt`.
*   Функция `setup_logging`:
    *   Создает директорию `logs/`, если она не существует.
    *   Создает/очищает `install_log.txt` при запуске `install.sh`.
    *   Создает/очищает `uninstall_log.txt` при запуске `uninstall.sh`.
    *   Создает/очищает `reinstall_log.txt` при запуске `reinstall.sh`.
    *   Создает `operations_log.txt`, если он не существует.
*   Функции для ротации и архивации `operations_log.txt` (используются `08_log_management.sh` и cron):

### `06_install_wstunnel.sh`
*   **Опциональный скрипт.**
*   Устанавливает `curl`.
*   Автоматически определяет последнюю версию Wstunnel для `linux_amd64` с GitHub.
*   Скачивает архив, распаковывает `wstunnel`, делает его исполняемым и перемещает в `/usr/local/bin/`.
*   Устанавливает `cap_net_bind_service=+ep` для бинарного файла `wstunnel`, чтобы разрешить ему использовать привилегированные порты без root.
*   Создает системного пользователя `wstunnel` без возможности входа (`--shell /usr/sbin/nologin`).
*   Генерирует случайный секретный ключ (`openssl rand -base64 42`) и сохраняет его в `/etc/wireguard/wstunnel_secret` (доступен только root).
*   Создает файл службы systemd (`/etc/systemd/system/wstunnel.service`) для запуска Wstunnel в режиме сервера. Команда запуска включает `--restrict-http-upgrade-path-prefix` с секретным ключом, `--restrict-to localhost:$WG_PORT` и `wss://0.0.0.0:$WSTUNNEL_PORT`. Служба запускается от имени пользователя `wstunnel`.
*   Перезагружает демона systemd, включает и запускает службу `wstunnel.service`.
*   Проверяет статус службы.
*   Сохраняет информацию для настройки клиентов (IP, порт, секрет) в файл в домашней директории пользователя.

### `07_backup_management.sh`
*   Создает необходимые поддиректории в `backups/` (`configs`, `logs`, `templates`), если они еще не созданы.
*   Копирует текущие активные конфигурационные файлы (например, `wg0.conf`, `privatekey`, `publickey`, `wstunnel_secret`, файлы служб systemd, `rules.v4`) в `backups/templates/` при первой установке как эталонные.
*   Реализует логику для создания периодических бэкапов конфигурационных файлов:
    *   Создает скрипт `scripts/utils/backup_utils.sh`, который будет выполнять копирование файлов из `/etc/wireguard/`, `/etc/systemd/system/` (связанных с VPN), `/etc/iptables/rules.v4` в `backups/configs/ИМЯ_БЭКАПА_ДАТА/`.
    *   Настраивает cron-задание для регулярного запуска `backup_utils.sh`. Периодичность и срок хранения бэкапов (`CONFIG_BACKUP_RETENTION_DAYS`) берутся из `config.conf`.
*   Пользователь может быть запрошен, хочет ли он включить автоматическое резервное копирование конфигураций.

### `08_log_management.sh`
*   Реализует логику для ротации и архивирования логов:
    *   Создает скрипт в `scripts/utils/log_utils.sh` или использует существующие утилиты (например, `logrotate`), который будет архивировать и перемещать `operations_log.txt` в `backups/logs/`.
    *   Настраивает cron-задание для регулярного выполнения ротации логов. Периодичность (`LOG_ROTATION_DAYS`) и срок хранения архивных логов (`LOG_BACKUP_RETENTION_DAYS`) берутся из `config.conf`.
    *   `install_log.txt` и `uninstall_log.txt` обычно не ротируются, а перезаписываются или добавляются при каждой новой установке/удалении.
*   Пользователь может быть запрошен, хочет ли он включить автоматическое управление логами.

## Вспомогательные утилиты (`scripts/utils/`)

### `detect_network.sh`
*   Содержит функции для определения:
    *   Публичного IP-адреса сервера (например, через `curl ifconfig.me` или аналогичные сервисы).
    *   IP-адреса шлюза по умолчанию (например, через `ip route | grep default`).
    *   Имени основного активного сетевого интерфейса.
*   Эти значения затем используются в `install.sh` и могут быть записаны в `config.conf`.

### `log_utils.sh`
*   Определяет функции для логирования:
    *   `log_info`: для информационных сообщений.
    *   `log_warning`: для предупреждений.
    *   `log_error`: для сообщений об ошибках.
    *   `log_install`: специфичные логи для `install_log.txt`.
    *   `log_uninstall`: специфичные логи для `uninstall_log.txt`.
    *   `log_reinstall`: специфичные логи для `reinstall_log.txt`.
*   Все функции должны добавлять временную метку к сообщениям.
*   Запись производится в соответствующие файлы в директории `logs/` и дублируется в `operations_log.txt` (кроме `log_install` и `log_uninstall`, которые пишут только в свои файлы и `operations_log.txt`).
*   Функция `setup_logging` для инициализации лог-файлов при старте основного скрипта.

### `backup_utils.sh`
*   Содержит функции, используемые `07_backup_management.sh` и cron-заданиями:
    *   Создание бэкапа конфигурационных файлов.
    *   Создание бэкапа (архивация) логов.
    *   Удаление старых бэкапов согласно политике хранения из `config.conf`.

### `system_utils.sh`
*   Содержит общие вспомогательные функции:
    *   Проверка, установлен ли пакет (`is_package_installed <имя_пакета>`).
    *   Проверка, запущена ли служба (`is_service_active <имя_службы>`).
    *   Функция для безопасного обновления значения в `config.conf` (например, `update_config_value "KEY" "NEW_VALUE"`).

## Директория логов (`logs/`)

*   `install_log.txt`: Содержит подробный пошаговый лог всего процесса установки, включая вывод команд. Перезаписывается или дополняется при каждом запуске `install.sh`.
*   `uninstall_log.txt`: Содержит подробный лог процесса удаления. Перезаписывается или дополняется при каждом запуске `uninstall.sh`.
*   `reinstall_log.txt`: Содержит подробный лог процесса переустановки. Перезаписывается или дополняется при каждом запуске `reinstall.sh`.
*   `operations_log.txt`: Общий лог операций всех скриптов (установка, удаление, переустановка, работа cron-заданий по бэкапам и ротации логов). Дополняется со временем. Подлежит ротации и архивации.
*   `wgdashboard_credentials.txt`: (Опционально) Может создаваться для сохранения сгенерированного пароля WGDashboard.

## Директория бэкапов (`backups/`)

*   `logs/`: Содержит архивные копии `operations_log.txt` после ротации.
*   `configs/`: Содержит резервные копии конфигурационных файлов, создаваемые перед их изменением или периодически.
*   `templates/`: Содержит "чистые" или первоначальные шаблоны конфигурационных файлов, которые могут использоваться для восстановления или сравнения.

## Руководства

*   `README.md`: Общее описание проекта, его цели и основные возможности.
*   `README_File_Structure_After_Project_Installation.md`: Данный файл - подробная документация по структуре файлов и директорий после установки проекта.
*   `README_Manual_Install.md`: Подробное руководство по ручной установке всех компонентов системы.
*   `manual/wstunnel_user_guide.md`: Руководство для конечного пользователя по настройке и использованию WSTunnel.